## 前言

> 本篇文章主要讲解一些mysql优化的策略





## 第一章 实例

### 大表格

#### 特征

1. 单表超过1千万行、且有较频繁的跟新操作
2. 单表大小超过10G

#### 对DDL的影响

1. 建立索引时间过长，MySQL版本<5.5造成死锁、mysql版本>5.5不会造成死锁，但是会引起主从延迟

2. 修改表结构需要长时间锁表、造成数据库引起插入操作被阻塞、从而造成主从延迟

   #### 解决方案

   ##### 大表的历史数据归档

   ###### 优点

   减少对前后端业务的影响

   ###### 难点

   1. 归档时间点的选择

   2. 如何进行归档操作（大表的大量ddl操作）

      ##### 分库分表

      ###### 难点

3. 分表的主键的选择

4. 分表和跨分区数据的查询和统计

### 事务

#### 特性

1. 原子性

   > 一个ddl操作要么全部执行、要么全部失败

2. 一致性

   > 事务将数据库从一种一致性状态转化到另一种一致性状态，事务开始之前和结束后数据库中数据的完整性没有被破坏，
   > 举个例子，从一张银行卡中转2000￥到另外一张卡，总金额是不变的

3. 隔离性

   > 其他数据库默认已提交读，而mysql默认可重复读

   1. 未提交读（READ UNCOMMITED）

      > 一个事务执行是可以读取另一个未提交事务的操作

   2. 已提交读（READ COMMITED）

      > 一个事务执行是可以读取另一个已提交事务的操作，是不可重复读

   3. 可重复读（READ REPEATED）

      > 同一个事务的执行结果相同，就算当其他事务提交了改变了数据

   4. 可串行化

      > 在读取的每一行上都加锁

4. 持久性（durability）

   > 事务提单提交，其所做的修改就会被永久的存到数据库中

#### 大事务

> 运行时间比较长，操作比较多的事务

#### 风险

1. 锁定太多的数据，造成大量的阻塞和 锁超时
2. 回滚时所需时间比较长
3. 执行时间长，造成主从延时

#### 解决方案

1. 避免一次处理太多的数据，采用分批处理
2. 移出不必要在事务中的select操作

### 